<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bayesian Hierarchical Ground-Motion Model</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.css" rel="stylesheet" type="text/css" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.95;
            margin-bottom: 20px;
        }

        .model-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .stat-box {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #4CAF50;
            backdrop-filter: blur(10px);
        }

        .stat-box h3 {
            font-size: 0.9em;
            opacity: 0.8;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stat-box .value {
            font-size: 1.8em;
            font-weight: bold;
        }

        .content {
            padding: 40px;
        }

        .section {
            margin-bottom: 50px;
        }

        .section-title {
            font-size: 1.6em;
            color: #667eea;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 3px solid #667eea;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .section-title::before {
            content: '';
            display: inline-block;
            width: 8px;
            height: 8px;
            background: #667eea;
            border-radius: 50%;
        }

        .graph-container {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
            border: 2px solid #e0e0e0;
        }

        #network {
            width: 100%;
            height: 600px;
            border-radius: 8px;
        }

        .description {
            background: #e3f2fd;
            border-left: 4px solid #2196F3;
            padding: 20px;
            border-radius: 4px;
            margin-bottom: 20px;
            line-height: 1.6;
            color: #1565c0;
        }

        .model-box {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 5px solid #667eea;
        }

        .model-box h3 {
            color: #667eea;
            margin-bottom: 12px;
            font-size: 1.2em;
        }

        .model-box p {
            color: #333;
            line-height: 1.7;
            margin-bottom: 10px;
        }

        .equation {
            background: white;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
            margin: 15px 0;
            border-left: 3px solid #ff9800;
            font-size: 0.95em;
        }

        .hierarchy {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .hierarchy-item {
            background: white;
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #e0e0e0;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .hierarchy-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(102, 126, 234, 0.3);
            border-color: #667eea;
        }

        .hierarchy-item .level {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .hierarchy-item h4 {
            color: #333;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .hierarchy-item p {
            color: #666;
            font-size: 0.95em;
            line-height: 1.6;
        }

        .parameter-list {
            list-style: none;
            margin-top: 10px;
        }

        .parameter-list li {
            color: #555;
            padding: 8px 0;
            font-size: 0.95em;
            border-bottom: 1px solid #eee;
        }

        .parameter-list li:last-child {
            border-bottom: none;
        }

        .parameter-list li::before {
            content: '‚ñ∏ ';
            color: #667eea;
            font-weight: bold;
            margin-right: 8px;
        }

        .priors {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 25px;
        }

        .prior-box {
            background: linear-gradient(135deg, #fff5e1 0%, #ffe0b2 100%);
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #ff9800;
        }

        .prior-box h4 {
            color: #e65100;
            margin-bottom: 10px;
            font-size: 1em;
            font-weight: bold;
        }

        .prior-box .prior-dist {
            font-family: 'Courier New', monospace;
            background: white;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            font-size: 0.9em;
            color: #333;
        }

        .process-flow {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
        }

        .process-step {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: #f5f5f5;
            border-radius: 6px;
        }

        .process-step .number {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            background: #667eea;
            color: white;
            border-radius: 50%;
            font-weight: bold;
            flex-shrink: 0;
        }

        .process-step .description {
            flex: 1;
            background: transparent;
            border: none;
            padding: 0;
            color: #333;
            margin: 0;
        }

        .insights {
            background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
            padding: 25px;
            border-radius: 8px;
            border-left: 5px solid #4CAF50;
            margin-top: 30px;
        }

        .insights h3 {
            color: #2e7d32;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .insights ul {
            list-style: none;
            color: #1b5e20;
        }

        .insights li {
            padding: 8px 0;
            margin-left: 0;
        }

        .insights li::before {
            content: '‚úì ';
            font-weight: bold;
            margin-right: 10px;
            color: #4CAF50;
        }

        .footer {
            background: #f5f5f5;
            padding: 25px 40px;
            text-align: center;
            color: #666;
            border-top: 2px solid #e0e0e0;
            margin-top: 40px;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }

            .model-stats {
                grid-template-columns: repeat(2, 1fr);
            }

            #network {
                height: 400px;
            }
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
        }

        .tab-button {
            padding: 12px 24px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1em;
            color: #999;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .tab-button.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .tab-button:hover {
            color: #667eea;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .highlight {
            background: #fff9c4;
            padding: 2px 6px;
            border-radius: 3px;
        }

        /* Advanced Connected Tree Plot Styles */
        .connected-tree-container {
            display: flex;
            justify-content: center;
            align-items: center;
            background: #ffffff;
            border-radius: 12px;
            padding: 60px 40px;
            border: 2px solid #e0e0e0;
            overflow: hidden;
            min-height: 700px;
            position: relative;
        }

        .connected-tree-wrapper {
            position: relative;
            width: 100%;
            max-width: 1000px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 120px;
        }

        /* SVG Canvas for arrows */
        .tree-canvas {
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        /* Level container */
        .tree-level-container {
            display: flex;
            justify-content: center;
            gap: 100px;
            width: 100%;
            position: relative;
            z-index: 2;
            align-items: center;
        }

        .tree-level-label {
            position: absolute;
            right: -250px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.05em;
            font-weight: 600;
            color: #333;
            white-space: nowrap;
            font-style: italic;
        }

        /* Single node */
        .tree-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            gap: 15px;
        }

        /* Circle node styling */
        .tree-node-circle {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 900;
            font-size: 1.5em;
            color: #222;
            text-align: center;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.25);
            border: 4px solid white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Times New Roman', serif;
            letter-spacing: 2px;
        }

        .tree-node-circle:hover {
            transform: scale(1.1);
            box-shadow: 0 12px 28px rgba(0, 0, 0, 0.35);
        }

        /* Level 0 - Parameters of population distribution */
        .level-0 .tree-node-circle {
            background: linear-gradient(135deg, #FFB3D9 0%, #FF9EC9 50%, #FF85BB 100%);
            width: 120px;
            height: 120px;
            font-size: 1.6em;
            color: #333;
            text-shadow: none;
        }

        /* Level 1 - Latent variables (random effects) */
        .level-1 .tree-node-circle {
            background: linear-gradient(135deg, #B3E5FC 0%, #81D4FA 50%, #4FC3F7 100%);
            width: 95px;
            height: 95px;
            font-size: 1.3em;
            color: #333;
            text-shadow: none;
        }

        .level-1-item:first-child .tree-node-circle,
        .level-1-item:last-child .tree-node-circle {
            background: linear-gradient(135deg, #B3E5FC 0%, #81D4FA 50%, #4FC3F7 100%);
        }

        .level-1-item:nth-child(2) .tree-node-circle {
            background: linear-gradient(135deg, #FFE0B2 0%, #FFCC80 50%, #FFB74D 100%);
        }

        .level-1-item:nth-child(3) .tree-node-circle {
            background: linear-gradient(135deg, #C8E6C9 0%, #A5D6A7 50%, #81C784 100%);
        }

        /* Level 2 - Observables (data) */
        .level-2 .tree-node-circle {
            background: linear-gradient(135deg, #FFCCBC 0%, #FFAB91 50%, #FF8A65 100%);
            width: 95px;
            height: 95px;
            font-size: 1.3em;
            color: #333;
            text-shadow: none;
        }

        .level-2-item:first-child .tree-node-circle,
        .level-2-item:last-child .tree-node-circle {
            background: linear-gradient(135deg, #FFCCBC 0%, #FFAB91 50%, #FF8A65 100%);
        }

        .level-2-item:nth-child(2) .tree-node-circle {
            background: linear-gradient(135deg, #E1BEE7 0%, #CE93D8 50%, #BA68C8 100%);
        }

        .level-2-item:nth-child(3) .tree-node-circle {
            background: linear-gradient(135deg, #C8E6C9 0%, #A5D6A7 50%, #81C784 100%);
        }

        /* Node label */
        .tree-node-label {
            font-size: 0.9em;
            font-weight: 600;
            color: #333;
            text-align: center;
            margin-top: 10px;
            min-height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Dots in the middle */
        .tree-dots {
            font-size: 2em;
            color: #999;
            margin: 0 30px;
        }

        /* Arrow styling */
        .arrow {
            fill: none;
            stroke: #999;
            stroke-width: 2.5;
            marker-end: url(#arrowhead);
            opacity: 0.6;
        }

        /* Title and description for tree levels */
        .tree-legend {
            display: flex;
            justify-content: space-between;
            width: 100%;
            margin-top: 60px;
            padding: 20px;
            background: white;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .legend-item {
            flex: 1;
            text-align: center;
            padding: 15px;
        }

        .legend-item h4 {
            color: #667eea;
            margin-bottom: 8px;
            font-size: 0.95em;
            font-weight: 700;
        }

        .legend-item p {
            color: #666;
            font-size: 0.85em;
            line-height: 1.5;
        }

        @media (max-width: 1200px) {
            .connected-tree-container {
                padding: 40px 20px;
                min-height: 600px;
            }

            .tree-level-label {
                position: relative;
                right: auto;
                transform: none;
                margin-top: 10px;
                font-size: 0.9em;
            }

            .connected-tree-wrapper {
                gap: 100px;
            }

            .tree-level-container {
                gap: 60px;
            }

            .tree-node-circle {
                width: 110px;
                height: 110px;
                font-size: 1.5em;
            }

            .level-0 .tree-node-circle {
                width: 130px;
                height: 130px;
                font-size: 1.8em;
            }
        }

        @media (max-width: 768px) {
            .connected-tree-container {
                padding: 30px 15px;
                min-height: 500px;
            }

            .tree-level-container {
                gap: 30px;
                flex-wrap: wrap;
            }

            .tree-node-circle {
                width: 90px;
                height: 90px;
                font-size: 1.2em;
            }

            .level-0 .tree-node-circle {
                width: 110px;
                height: 110px;
                font-size: 1.5em;
            }

            .tree-dots {
                font-size: 1.5em;
                margin: 0 15px;
            }

            .tree-legend {
                flex-direction: column;
                gap: 15px;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>üéØ Bayesian Hierarchical Ground-Motion Model</h1>
            <p>NumPyro-based Student-t Regression for S-Wave Intensity Analysis</p>
            <div class="model-stats">
                <div class="stat-box">
                    <h3>Hierarchical Levels</h3>
                    <div class="value">4</div>
                </div>
                <div class="stat-box">
                    <h3>Total Parameters</h3>
                    <div class="value">13+</div>
                </div>
                <div class="stat-box">
                    <h3>Inference Method</h3>
                    <div class="value">NUTS</div>
                </div>
                <div class="stat-box">
                    <h3>Framework</h3>
                    <div class="value">NumPyro</div>
                </div>
            </div>
        </div>

        <div class="content">
            <!-- Model Architecture Section -->
            <div class="section">
                <h2 class="section-title">üèóÔ∏è Model Architecture</h2>
                <div class="graph-container">
                    <div id="network"></div>
                </div>
            </div>

            <!-- Hierarchical Tree Structure Section -->
            <div class="section">
                <h2 class="section-title">üå≥ Hierarchical Tree Structure</h2>
                <div class="connected-tree-container">
                    <!-- SVG for arrows -->
                    <svg class="tree-canvas" id="treeSvg">
                        <defs>
                            <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                                <polygon points="0 0, 10 3, 0 6" fill="#999" />
                            </marker>
                        </defs>
                    </svg>

                    <div class="connected-tree-wrapper">
                        <!-- Level 0: Parameters of population distribution -->
                        <div class="tree-level-container level-0">
                            <div class="tree-item">
                                <div class="tree-node-circle">Œ∏</div>
                                <div class="tree-node-label">Population Distribution<br>Parameters</div>
                            </div>
                            <div class="tree-level-label">Parameters of<br>population distribution<br><small
                                    style="font-size: 0.85em; font-weight: normal;">Œ≤‚ÇÄ, Œ≤_mag, Œ≤_dist, Œ≤_depth<br>œÉ_obs,
                                    ŒΩ_obs</small></div>
                        </div>

                        <!-- Level 1: Latent variables (random effects) -->
                        <div class="tree-level-container level-1">
                            <div class="tree-item level-1-item">
                                <div class="tree-node-circle">Œ∑</div>
                                <div class="tree-node-label">Event Effects<br>Œ∑_event[i]<br>œÉ_event, ŒΩ_event</div>
                            </div>
                            <div class="tree-item level-1-item">
                                <div class="tree-node-circle">Œ¥</div>
                                <div class="tree-node-label">Station Effects<br>Œ¥_station[j]<br>œÉ_station, ŒΩ_station
                                </div>
                            </div>
                            <div class="tree-item level-1-item">
                                <div class="tree-node-circle">Œ≥</div>
                                <div class="tree-node-label">Site Class Effects<br>Œ≥_site[k]<br>œÉ_site, ŒΩ_site</div>
                            </div>
                            <div class="tree-item level-1-item">
                                <div class="tree-node-circle">Œæ</div>
                                <div class="tree-node-label">Event-Station<br>Interactions<br>Œæ_event_station[ij]</div>
                            </div>
                            <div class="tree-level-label">Latent variables<br>"random effects"<br><small
                                    style="font-size: 0.85em; font-weight: normal;">Hierarchical<br>Random
                                    Intercepts</small></div>
                        </div>

                        <!-- Level 2: Observables (data) -->
                        <div class="tree-level-container level-2">
                            <div class="tree-item level-2-item">
                                <div class="tree-node-circle">y<sub>1</sub></div>
                                <div class="tree-node-label">Log-Intensity<br>Event 1</div>
                            </div>
                            <div class="tree-item level-2-item">
                                <div class="tree-node-circle">y<sub>2</sub></div>
                                <div class="tree-node-label">Log-Intensity<br>Event 2</div>
                            </div>
                            <div class="tree-item level-2-item">
                                <div class="tree-node-circle">y<sub>3</sub></div>
                                <div class="tree-node-label">Log-Intensity<br>Event 3</div>
                            </div>
                            <div class="tree-item level-2-item">
                                <div class="tree-node-circle">y<sub>N</sub></div>
                                <div class="tree-node-label">Log-Intensity<br>Event N</div>
                            </div>
                            <div class="tree-level-label">Observables<br>(data)<br><small
                                    style="font-size: 0.85em; font-weight: normal;">Ground Motion<br>Intensity
                                    (PGA)<br>~ StudentT(Œº, œÉ_obs, ŒΩ_obs)</small></div>
                        </div>
                    </div>
                </div>

                <!-- Legend -->
                <div class="tree-legend" style="margin-top: 30px;">
                    <div class="legend-item">
                        <h4>üèõÔ∏è Level 0: Population Distribution</h4>
                        <p><strong>Global Regression Coefficients:</strong><br>
                            ‚Ä¢ Œ≤‚ÇÄ (Intercept)<br>
                            ‚Ä¢ Œ≤_mag (Magnitude effect)<br>
                            ‚Ä¢ Œ≤_dist (Distance effect)<br>
                            ‚Ä¢ Œ≤_depth (Depth effect)<br>
                            ‚Ä¢ œÉ_obs, ŒΩ_obs (Observation noise & robustness)</p>
                    </div>
                    <div class="legend-item">
                        <h4>‚ö° Level 1: Latent Random Effects</h4>
                        <p><strong>Hierarchical Group Effects:</strong><br>
                            ‚Ä¢ Œ∑_event[i] - Earthquake-specific intercepts<br>
                            ‚Ä¢ Œ¥_station[j] - Recording station bias<br>
                            ‚Ä¢ Œ≥_site[k] - Geological site amplification<br>
                            ‚Ä¢ Œæ_event_station[ij] - Event-station interactions<br>
                            Each with scale (œÉ) & degrees of freedom (ŒΩ)</p>
                    </div>
                    <div class="legend-item">
                        <h4>üìä Level 2: Observed Data</h4>
                        <p><strong>Ground Motion Measurements:</strong><br>
                            ‚Ä¢ y ~ StudentT(Œº, œÉ_obs, ŒΩ_obs)<br>
                            ‚Ä¢ Œº = Œ≤‚ÇÄ + Œ≤_mag¬∑magnitude + Œ≤_dist¬∑distance<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;+ Œ≤_depth¬∑depth + Œ∑ + Œ¥ + Œ≥ + Œæ<br>
                            ‚Ä¢ Log-transformed PGA intensity<br>
                            ‚Ä¢ Robust to outliers (Student-t)</p>
                    </div>
                </div>
            </div>

            <!-- Overview Section -->
            <div class="section">
                <h2 class="section-title">üìã Model Overview</h2>
                <div class="description">
                    This is a <span class="highlight">hierarchical Student-t regression model</span> designed to analyze
                    ground-motion
                    intensity data from seismic events recorded across multiple stations. The model captures variability
                    at multiple levels: global effects, event-specific effects, station effects, site classification
                    effects,
                    and event-station interactions, all modeled with robust Student-t distributions.
                </div>

                <div class="model-box">
                    <h3>Core Response Model</h3>
                    <p><strong>Linear Regression with Hierarchical Components:</strong></p>
                    <div class="equation">
                        Œº = Œ≤‚ÇÄ + Œ≤_mag¬∑magnitude + Œ≤_dist¬∑distance + Œ≤_depth¬∑depth
                        + Œ∑_event[i] + Œ¥_station[j] + Œ≥_site[k] + Œæ_event_station[ij]
                    </div>
                    <p><strong>Likelihood:</strong></p>
                    <div class="equation">
                        y ~ StudentT(df=ŒΩ_obs, loc=Œº, scale=œÉ_obs)
                    </div>
                    <p style="margin-top: 15px; color: #555; font-size: 0.95em;">
                        The <strong>Student-t distribution</strong> with estimated degrees of freedom (ŒΩ) provides
                        robustness to outliers compared to normal distributions, making it ideal for ground-motion data
                        which often contains extreme values.
                    </p>
                </div>
            </div>

            <!-- Hierarchical Structure Section -->
            <div class="section">
                <h2 class="section-title">üîÄ Hierarchical Levels</h2>

                <div class="tabs">
                    <button class="tab-button active" onclick="switchTab('overview')">Overview</button>
                    <button class="tab-button" onclick="switchTab('details')">Detailed Structure</button>
                </div>

                <div id="overview" class="tab-content active">
                    <div class="hierarchy">
                        <div class="hierarchy-item">
                            <span class="level">Level 0</span>
                            <h4>üåç Global Parameters</h4>
                            <p>Population-level regression coefficients and observation noise parameters</p>
                            <ul class="parameter-list">
                                <li>Œ≤‚ÇÄ (Intercept)</li>
                                <li>Œ≤_mag (Magnitude effect)</li>
                                <li>Œ≤_dist (Distance effect)</li>
                                <li>Œ≤_depth (Depth effect)</li>
                                <li>œÉ_obs, ŒΩ_obs (Obs. noise)</li>
                            </ul>
                        </div>

                        <div class="hierarchy-item">
                            <span class="level">Level 1</span>
                            <h4>‚ö° Event Effects</h4>
                            <p>Earthquake-specific random intercepts accounting for event heterogeneity</p>
                            <ul class="parameter-list">
                                <li>Œ∑_event[1..N_events]</li>
                                <li>œÉ_event (Event SD)</li>
                                <li>ŒΩ_event (Robustness)</li>
                            </ul>
                        </div>

                        <div class="hierarchy-item">
                            <span class="level">Level 2</span>
                            <h4>üè¢ Station Effects</h4>
                            <p>Instrument and site amplification at recording stations</p>
                            <ul class="parameter-list">
                                <li>Œ¥_station[1..N_stations]</li>
                                <li>œÉ_station (Station SD)</li>
                                <li>ŒΩ_station (Robustness)</li>
                            </ul>
                        </div>

                        <div class="hierarchy-item">
                            <span class="level">Level 3</span>
                            <h4>ü™® Site Class Effects</h4>
                            <p>Ground classification effects (e.g., rock, soil) on amplification</p>
                            <ul class="parameter-list">
                                <li>Œ≥_site[1..N_classes]</li>
                                <li>œÉ_site (Site SD)</li>
                                <li>ŒΩ_site (Robustness)</li>
                            </ul>
                        </div>

                        <div class="hierarchy-item">
                            <span class="level">Level 4</span>
                            <h4>üîó Event-Station Interactions</h4>
                            <p>Pairwise interactions between events and stations</p>
                            <ul class="parameter-list">
                                <li>Œæ_event_station[1..N_pairs]</li>
                                <li>œÉ_interaction (Interact. SD)</li>
                                <li>ŒΩ_interaction (Robustness)</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div id="details" class="tab-content">
                    <div class="model-box">
                        <h3>Regression Coefficients (Level 0)</h3>
                        <div class="equation">Œ≤‚ÇÄ, Œ≤_mag, Œ≤_dist, Œ≤_depth ~ Normal(0, 5)</div>
                        <p>These global parameters control the mean response as a function of magnitude, distance, and
                            depth.</p>
                    </div>

                    <div class="model-box">
                        <h3>Event Random Effects (Level 1)</h3>
                        <div class="equation">
                            Œ∑_event[i] ~ StudentT(df=ŒΩ_event, loc=0, scale=œÉ_event) for i=1..N_events
                            œÉ_event ~ HalfNormal(1)
                            ŒΩ_event ~ Exponential(1/30)
                        </div>
                        <p>Each earthquake has its own offset from the global trend, modeled as a Student-t random
                            intercept to handle outlier events.</p>
                    </div>

                    <div class="model-box">
                        <h3>Station Random Effects (Level 2)</h3>
                        <div class="equation">
                            Œ¥_station[j] ~ StudentT(df=ŒΩ_station, loc=0, scale=œÉ_station) for j=1..N_stations
                            œÉ_station ~ HalfNormal(1)
                            ŒΩ_station ~ Exponential(1/30)
                        </div>
                        <p>Each recording station contributes its own bias, capturing instrument and local site effects.
                        </p>
                    </div>

                    <div class="model-box">
                        <h3>Site Class Random Effects (Level 3)</h3>
                        <div class="equation">
                            Œ≥_site[k] ~ StudentT(df=ŒΩ_site, loc=0, scale=œÉ_site) for k=1..N_site_classes
                            œÉ_site ~ HalfNormal(1)
                            ŒΩ_site ~ Exponential(1/30)
                        </div>
                        <p>Site amplification factors vary by geological classification (e.g., soft soil amplifies more
                            than rock).</p>
                    </div>

                    <div class="model-box">
                        <h3>Event-Station Interactions (Level 4)</h3>
                        <div class="equation">
                            Œæ_event_station[ij] ~ StudentT(df=ŒΩ_interaction, loc=0, scale=œÉ_interaction)
                            œÉ_interaction ~ HalfNormal(1)
                            ŒΩ_interaction ~ Exponential(1/30)
                        </div>
                        <p>Pairwise interactions capture station-specific amplification that varies by event.</p>
                    </div>
                </div>
            </div>

            <!-- Priors Section -->
            <div class="section">
                <h2 class="section-title">üìä Prior Specifications</h2>
                <div class="description">
                    The model uses weakly informative priors to regularize estimation while allowing the data to drive
                    inference.
                </div>

                <div class="priors">
                    <div class="prior-box">
                        <h4>Regression Coefficients</h4>
                        <div class="prior-dist">Œ≤ ~ Normal(0, 5)</div>
                        <p>Weakly informative: allows moderate effects</p>
                    </div>

                    <div class="prior-box">
                        <h4>Scale Parameters</h4>
                        <div class="prior-dist">œÉ ~ HalfNormal(1)</div>
                        <p>Regularizes variance; prevents excessive variation</p>
                    </div>

                    <div class="prior-box">
                        <h4>Degrees of Freedom</h4>
                        <div class="prior-dist">ŒΩ ~ Exponential(1/30)</div>
                        <p>Encourages Student-t robustness; means ‚âà 30</p>
                    </div>
                </div>
            </div>

            <!-- Inference Process Section -->
            <div class="section">
                <h2 class="section-title">üîÑ Inference Process</h2>
                <div class="description">
                    The model employs Hamiltonian Monte Carlo (HMC) via the NUTS (No-U-Turn Sampler) algorithm
                    implemented in NumPyro for efficient posterior sampling.
                </div>

                <div class="process-flow">
                    <div class="process-step">
                        <div class="number">1</div>
                        <div class="description">
                            <strong>Data Preparation:</strong> Load earthquake metadata, standardize continuous
                            predictors
                            (magnitude, distance, depth), encode categorical variables (events, stations, site classes)
                        </div>
                    </div>

                    <div class="process-step">
                        <div class="number">2</div>
                        <div class="description">
                            <strong>Model Definition:</strong> Specify hierarchical structure with Student-t
                            distributions
                            and weakly informative priors using NumPyro sampling syntax
                        </div>
                    </div>

                    <div class="process-step">
                        <div class="number">3</div>
                        <div class="description">
                            <strong>NUTS Sampling:</strong> Run No-U-Turn Sampler across multiple chains (default: 4)
                            with warmup (2000 iterations) followed by sampling (2000 iterations per chain)
                        </div>
                    </div>

                    <div class="process-step">
                        <div class="number">4</div>
                        <div class="description">
                            <strong>Diagnostics:</strong> Assess convergence via R-hat, effective sample size (ESS),
                            trace plots, and posterior predictive checks
                        </div>
                    </div>

                    <div class="process-step">
                        <div class="number">5</div>
                        <div class="description">
                            <strong>Posterior Analysis:</strong> Extract posterior means and credible intervals;
                            generate posterior predictive distributions for validation
                        </div>
                    </div>
                </div>
            </div>

            <!-- Key Insights Section -->
            <div class="section">
                <h2 class="section-title">üí° Key Features</h2>
                <div class="insights">
                    <h3>Why This Model?</h3>
                    <ul>
                        <li><strong>Hierarchical structure:</strong> Borrows strength across events, stations, and site
                            classes</li>
                        <li><strong>Student-t distributions:</strong> Robust to outliers and extreme ground motion
                            values</li>
                        <li><strong>Flexible random effects:</strong> Captures heterogeneity at multiple scales</li>
                        <li><strong>Efficient NUTS sampling:</strong> Scales to large datasets with JAX autodiff</li>
                        <li><strong>Interpretable posteriors:</strong> Quantify uncertainty in all model parameters</li>
                        <li><strong>Posterior predictive checks:</strong> Validate model assumptions against observed
                            data</li>
                        <li><strong>Scalable inference:</strong> CPU/GPU acceleration available via JAX</li>
                        <li><strong>Domain-relevant:</strong> Incorporates seismic physics (magnitude, distance, depth,
                            site effects)</li>
                    </ul>
                </div>
            </div>

            <div class="footer">
                <p>Bayesian Hierarchical Ground-Motion Model | NumPyro Implementation</p>
                <p style="font-size: 0.9em; margin-top: 10px; opacity: 0.7;">
                    Generated with üéì for seismic ground-motion analysis |
                    <a href="https://numpyro.readthedocs.io/" style="color: #667eea; text-decoration: none;">NumPyro
                        Documentation</a>
                </p>
            </div>
        </div>
    </div>

    <script>
        // Network visualization using vis.js
        const nodes = new vis.DataSet([
            // Level 0 - Global
            { id: 1, label: 'Œ≤‚ÇÄ\n(Intercept)', group: 'level0', title: 'Global intercept parameter' },
            { id: 2, label: 'Œ≤_mag\n(Magnitude)', group: 'level0', title: 'Magnitude effect coefficient' },
            { id: 3, label: 'Œ≤_dist\n(Distance)', group: 'level0', title: 'Distance effect coefficient' },
            { id: 4, label: 'Œ≤_depth\n(Depth)', group: 'level0', title: 'Depth effect coefficient' },
            { id: 5, label: 'œÉ_obs, ŒΩ_obs\n(Obs. Noise)', group: 'level0', title: 'Observation noise parameters' },

            // Level 1 - Events
            { id: 6, label: 'œÉ_event\nŒΩ_event', group: 'level1', title: 'Event effect scale and robustness' },
            { id: 7, label: 'Œ∑_event[i]\n(Event Effects)', group: 'level1', title: 'Random intercepts per event' },

            // Level 2 - Stations
            { id: 8, label: 'œÉ_station\nŒΩ_station', group: 'level2', title: 'Station effect scale and robustness' },
            { id: 9, label: 'Œ¥_station[j]\n(Station Effects)', group: 'level2', title: 'Random intercepts per station' },

            // Level 3 - Site Classes
            { id: 10, label: 'œÉ_site\nŒΩ_site', group: 'level3', title: 'Site effect scale and robustness' },
            { id: 11, label: 'Œ≥_site[k]\n(Site Effects)', group: 'level3', title: 'Random intercepts per site class' },

            // Level 4 - Interactions
            { id: 12, label: 'œÉ_inter\nŒΩ_inter', group: 'level4', title: 'Interaction effect scale and robustness' },
            { id: 13, label: 'Œæ_event_station[ij]\n(Interactions)', group: 'level4', title: 'Event-station interaction effects' },

            // Data/Likelihood
            { id: 14, label: 'Œº\n(Linear Predictor)', group: 'likelihood', title: 'Combination of all effects' },
            { id: 15, label: 'y ~ StudentT\n(Likelihood)', group: 'likelihood', title: 'Observed log-intensity data' },

            // Inputs
            { id: 16, label: 'magnitude\n(Standardized)', group: 'input', title: 'Earthquake magnitude' },
            { id: 17, label: 'distance\n(Standardized)', group: 'input', title: 'Epicentral distance' },
            { id: 18, label: 'depth\n(Standardized)', group: 'input', title: 'Event depth' },
            { id: 19, label: 'event_id\nevent_index', group: 'input', title: 'Event indexing' },
            { id: 20, label: 'station_id\nstation_index', group: 'input', title: 'Station indexing' },
            { id: 21, label: 'site_class_id\nsite_index', group: 'input', title: 'Site class indexing' },
        ]);

        const edges = new vis.DataSet([
            // Global parameters to linear predictor
            { from: 1, to: 14, arrows: 'to', smooth: { type: 'continuous' }, label: '', color: { color: '#667eea' } },
            { from: 2, to: 14, arrows: 'to', smooth: { type: 'continuous' }, label: '', color: { color: '#667eea' } },
            { from: 3, to: 14, arrows: 'to', smooth: { type: 'continuous' }, label: '', color: { color: '#667eea' } },
            { from: 4, to: 14, arrows: 'to', smooth: { type: 'continuous' }, label: '', color: { color: '#667eea' } },

            // Inputs to global parameters
            { from: 16, to: 2, arrows: 'to', smooth: { type: 'continuous' }, dashes: true, color: { color: '#999' } },
            { from: 17, to: 3, arrows: 'to', smooth: { type: 'continuous' }, dashes: true, color: { color: '#999' } },
            { from: 18, to: 4, arrows: 'to', smooth: { type: 'continuous' }, dashes: true, color: { color: '#999' } },

            // Event effects
            { from: 6, to: 7, arrows: 'to', label: 'scale', color: { color: '#ff6b6b' } },
            { from: 7, to: 14, arrows: 'to', smooth: { type: 'continuous' }, color: { color: '#ff6b6b' } },
            { from: 19, to: 7, arrows: 'to', dashes: true, color: { color: '#999' } },

            // Station effects
            { from: 8, to: 9, arrows: 'to', label: 'scale', color: { color: '#4ecdc4' } },
            { from: 9, to: 14, arrows: 'to', smooth: { type: 'continuous' }, color: { color: '#4ecdc4' } },
            { from: 20, to: 9, arrows: 'to', dashes: true, color: { color: '#999' } },

            // Site effects
            { from: 10, to: 11, arrows: 'to', label: 'scale', color: { color: '#ffd93d' } },
            { from: 11, to: 14, arrows: 'to', smooth: { type: 'continuous' }, color: { color: '#ffd93d' } },
            { from: 21, to: 11, arrows: 'to', dashes: true, color: { color: '#999' } },

            // Interaction effects
            { from: 12, to: 13, arrows: 'to', label: 'scale', color: { color: '#a78bfa' } },
            { from: 13, to: 14, arrows: 'to', smooth: { type: 'continuous' }, color: { color: '#a78bfa' } },

            // Linear predictor to likelihood
            { from: 14, to: 15, arrows: 'to', smooth: { type: 'continuous' }, color: { color: '#50c878' } },
            { from: 5, to: 15, arrows: 'to', smooth: { type: 'continuous' }, color: { color: '#50c878' } },
        ]);

        const groups = {
            level0: { color: { background: '#e3f2fd', border: '#667eea', highlight: { background: '#bbdefb' } }, font: { size: 12, bold: { size: 14 } } },
            level1: { color: { background: '#ffebee', border: '#ff6b6b', highlight: { background: '#ffcdd2' } }, font: { size: 12 } },
            level2: { color: { background: '#e0f2f1', border: '#4ecdc4', highlight: { background: '#b2dfdb' } }, font: { size: 12 } },
            level3: { color: { background: '#fff8e1', border: '#ffd93d', highlight: { background: '#ffecb3' } }, font: { size: 12 } },
            level4: { color: { background: '#f3e5f5', border: '#a78bfa', highlight: { background: '#e1bee7' } }, font: { size: 12 } },
            input: { color: { background: '#f5f5f5', border: '#999', highlight: { background: '#eeeeee' } }, font: { size: 11, italic: true } },
            likelihood: { color: { background: '#e8f5e9', border: '#50c878', highlight: { background: '#c8e6c9' } }, font: { size: 12, bold: { size: 14 } } },
        };

        const container = document.getElementById('network');
        const data = { nodes: nodes, edges: edges };
        const options = {
            physics: {
                enabled: true,
                solver: 'hierarchicalRepulsion',
                hierarchicalRepulsion: {
                    centralGravity: 0.0,
                    springLength: 200,
                    springConstant: 0.01,
                },
                forceAtlas2Based: {
                    gravitationalConstant: -26,
                    centralGravity: 0.005,
                    springLength: 200,
                    springConstant: 0.08,
                    damping: 0.4,
                    overlap: 0,
                },
                maxVelocity: 50,
                timestep: 0.35,
                stabilization: { iterations: 150 },
            },
            groups: groups,
            nodes: {
                font: { size: 13, color: '#333', face: 'Segoe UI' },
                borderWidth: 2,
                shadow: { enabled: true, color: 'rgba(0,0,0,0.2)', size: 10, x: 5, y: 5 },
            },
            edges: {
                arrows: { to: { enabled: true, scaleFactor: 1 } },
                shadow: { enabled: false },
                smooth: { type: 'continuous' },
                width: 2,
                font: { size: 10, color: '#666' },
            },
            interaction: {
                hover: true,
                navigationButtons: true,
                keyboard: true,
                zoomView: true,
                dragView: true,
            },
            layout: {
                improvedLayout: true,
            },
        };

        const network = new vis.Network(container, data, options);

        // Tab switching
        function switchTab(tabName) {
            const contents = document.querySelectorAll('.tab-content');
            const buttons = document.querySelectorAll('.tab-button');

            contents.forEach(content => content.classList.remove('active'));
            buttons.forEach(button => button.classList.remove('active'));

            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        // Tooltip on hover
        network.on('hoverNode', function (params) {
            const node = nodes.get(params.node);
            if (node.title) {
                network.setOptions({
                    physics: { enabled: false }
                });
            }
        });

        network.on('blurNode', function (params) {
            network.setOptions({
                physics: { enabled: false }
            });
        });

        // Draw arrows for connected tree plot
        function drawTreeArrows() {
            const svg = document.getElementById('treeSvg');
            if (!svg) return;

            // Get all tree circles
            const level0Circle = document.querySelector('.level-0 .tree-node-circle');
            const level1Circles = Array.from(document.querySelectorAll('.level-1 .tree-node-circle'));
            const level2Circles = Array.from(document.querySelectorAll('.level-2 .tree-node-circle'));

            if (!level0Circle || level1Circles.length === 0 || level2Circles.length === 0) return;

            const container = svg.parentElement;
            const svgWidth = container.offsetWidth;
            const svgHeight = container.offsetHeight;

            // Clear existing arrows
            svg.querySelectorAll('.arrow').forEach(arrow => arrow.remove());

            // Helper function to get center position relative to container
            function getCircleCenter(circle) {
                const rect = circle.getBoundingClientRect();
                const containerRect = container.getBoundingClientRect();
                return {
                    x: rect.left - containerRect.left + rect.width / 2,
                    y: rect.top - containerRect.top + rect.height / 2
                };
            }

            // Helper function to draw arrow line
            function drawArrow(fromCircle, toCircle) {
                const from = getCircleCenter(fromCircle);
                const to = getCircleCenter(toCircle);

                const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                line.setAttribute('x1', from.x);
                line.setAttribute('y1', from.y);
                line.setAttribute('x2', to.x);
                line.setAttribute('y2', to.y);
                line.setAttribute('class', 'arrow');
                svg.appendChild(line);
            }

            // Draw arrows from level 0 to all level 1 circles
            level1Circles.forEach(circle => {
                drawArrow(level0Circle, circle);
            });

            // Draw arrows from level 1 to level 2
            // Strategy: Connect first level1 to first level2, last level1 to last level2
            // Middle level1 nodes connect to middle level2 nodes
            level2Circles.forEach((circle, idx) => {
                let sourceIdx;
                if (idx === 0) {
                    sourceIdx = 0; // First level2 from first level1
                } else if (idx === level2Circles.length - 1) {
                    sourceIdx = level1Circles.length - 1; // Last level2 from last level1
                } else {
                    // Distribute middle indices
                    sourceIdx = Math.floor((idx / level2Circles.length) * level1Circles.length);
                    sourceIdx = Math.min(sourceIdx, level1Circles.length - 1);
                }
                drawArrow(level1Circles[sourceIdx], circle);
            });
        }

        // Draw arrows on page load and window resize
        window.addEventListener('load', drawTreeArrows);
        window.addEventListener('resize', drawTreeArrows);
        setTimeout(drawTreeArrows, 500);
    </script>
</body>

</html>